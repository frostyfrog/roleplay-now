{% macro cssClass(character) %}chara-{{ character.Name|e('css')|replace({' ':''})|replace({'\\':'--'}) }}{% endmacro %}
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{ title }} - RP Server</title>
    <link rel="stylesheet" type="text/css" href="room.css">
    <style>
      {% for character in characters if character.Name != "Narrator" %}
        .{{ _self.cssClass(character) }} {
          background-color: {{ character.Color }};
          color: {{ character.Contrast }};
        }
      {% endfor %}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
      $(document).ready(function() {
        $('.character a').click(function(evt) {
          $('#mb-name').val(evt.target.text.trim());
        });
      });
    </script>
  </head>
  <body>
    <header>
      <h2>{{ title }}</h2>
      <p>{{ desc }}</p>
      <p>
        <a href="/{{ room }}/1">Archive</a> |
        <a href="/{{ room }}/export">Export</a> |
        <a href="/{{ room }}/stats">Stats</a> |
        <a href="/">New RP</a>
      </p>
    </header>
    <div id="messages">
      {% for message in messages %}
        <div class="message {{ _self.cssClass(message) }}">
          <div class="name">{{ message.Name }}</div>
          <div class="content">{{ message.Content|nl2br }}</div>
        </div>
      {% else %}
        <p>Our story begins...</p>
      {% endfor %}
    </div>
    <div id="characters">
      {% for character in characters %}
        <div class="character">
          <a href="#" class="{{ _self.cssClass(character) }}">
            {{ character.Name }}
          </a>
        </div>
      {% endfor %}
      <div id="new-character">
        <form id="char-form" action="/{{ room }}/character" method="post">
          New Character: <input type="text" name="name"></input>
          Color: <input type="color" name="color" value="#FFFFFF"></input>
          <input type="submit" value="Add"></input>
        </form>
      </div>
    </div>
    <form id="message-box" action="/{{ room }}/send" method="post">
      <table>
        <tr>
          <td colspan="2"><input type="text" name="name" id="mb-name" value="Narrator"></input></td>
        </tr>
        <tr>
          <td id="input-col"><textarea name="content"></textarea></td>
          <td id="button-col"><input type="submit" value="Send"></input></td>
        </tr>
      </table>
    </form>
  </body>
</html>